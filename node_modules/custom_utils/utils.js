var User = require('mongoose').model('User');

module.exports = {
    requiresLogin: function(req, res, next) {

        User.authenticate( req.cookies.email, req.cookies.token, function(err, user) {
            if( err || !user ) {
                res.render('errors/403');
            } else {
                next();
            }

        });
    },

    requiresAuthHeaders: function(req, res, next) {
        if( req.header('password') || req.header('token') ) {
            next();
        } else {
            res.send(401, 'Authentication required.');
        }
    },

    isLoggedIn: function(req, callback) {
        User.authenticate( req.cookies.email, req.cookies.token, function(err, user) {
            if( err || !user ) {
                callback(undefined);
            } else {
                callback(user);
            }
        });
    }
};